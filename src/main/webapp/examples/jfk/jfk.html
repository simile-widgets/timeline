<html>
<head>
    <title>Timeline Example: The JFK Assassination</title>
    <link rel='stylesheet' href='../styles.css' type='text/css' />
    <script src="../../api/timeline-api.js" type="text/javascript"></script>
    <script>
        var tl;
        function onLoad() {
            var eventSource = new Timeline.DefaultEventSource(-6);
            
            var zones = [
                {   start:    "Fri Nov 22 1963 00:00:00 GMT-0600",
                    end:      "Mon Nov 25 1963 00:00:00 GMT-0600",
                    magnify:  10,
                    unit:     Timeline.DateTime.DAY
                },
                {   start:    "Fri Nov 22 1963 09:00:00 GMT-0600",
                    end:      "Sun Nov 24 1963 00:00:00 GMT-0600",
                    magnify:  5,
                    unit:     Timeline.DateTime.HOUR
                },
                {   start:    "Fri Nov 22 1963 11:00:00 GMT-0600",
                    end:      "Sat Nov 23 1963 00:00:00 GMT-0600",
                    magnify:  5,
                    unit:     Timeline.DateTime.MINUTE,
                    multiple: 10
                },
                {   start:    "Fri Nov 22 1963 12:00:00 GMT-0600",
                    end:      "Fri Nov 22 1963 14:00:00 GMT-0600",
                    magnify:  3,
                    unit:     Timeline.DateTime.MINUTE,
                    multiple: 5
                }
            ];
            var zones2 = [
                {   start:    "Fri Nov 22 1963 00:00:00 GMT-0600",
                    end:      "Mon Nov 25 1963 00:00:00 GMT-0600",
                    magnify:  10,
                    unit:     Timeline.DateTime.WEEK
                },
                {   start:    "Fri Nov 22 1963 09:00:00 GMT-0600",
                    end:      "Sun Nov 24 1963 00:00:00 GMT-0600",
                    magnify:  5,
                    unit:     Timeline.DateTime.DAY
                },
                {   start:    "Fri Nov 22 1963 11:00:00 GMT-0600",
                    end:      "Sat Nov 23 1963 00:00:00 GMT-0600",
                    magnify:  5,
                    unit:     Timeline.DateTime.MINUTE,
                    multiple: 60
                },
                {   start:    "Fri Nov 22 1963 12:00:00 GMT-0600",
                    end:      "Fri Nov 22 1963 14:00:00 GMT-0600",
                    magnify:  3,
                    unit:     Timeline.DateTime.MINUTE,
                    multiple: 15
                }
            ];
            
            var theme = Timeline.ClassicTheme.create();
            theme.event.label.width = 250; // px
            theme.event.bubble.width = 250;
            theme.event.bubble.height = 200;
            
            var date = "Fri Nov 22 1963 13:00:00 GMT-0600"
            var bandInfos = [
                Timeline.createHotZoneBandInfo({
                    width:          "75%", 
                    intervalUnit:   Timeline.DateTime.WEEK, 
                    intervalPixels: 200,
                    zones:          zones,
                    eventSource:    eventSource,
                    date:           date,
                    timeZone:       -6,
                    theme:          theme
                }),
                Timeline.createHotZoneBandInfo({
                    width:          "25%", 
                    intervalUnit:   Timeline.DateTime.MONTH, 
                    intervalPixels: 200,
                    zones:          zones2, 
                    eventSource:    eventSource,
                    date:           date, 
                    timeZone:       -6,
                    showEventText:  false, 
                    trackHeight:    0.5,
                    trackGap:       0.2,
                    theme:          theme
                })
            ];
            bandInfos[1].syncWith = 0;
            bandInfos[1].highlight = true;
            bandInfos[1].eventPainter.setLayout(bandInfos[0].eventPainter.getLayout());
            
            for (var i = 0; i < bandInfos.length; i++) {
                bandInfos[i].decorators = [
                    new Timeline.SpanHighlightDecorator({
                        startDate:  "Fri Nov 22 1963 12:30:00 GMT-0600",
                        endDate:    "Fri Nov 22 1963 13:00:00 GMT-0600",
                        color:      "#FFC080",
                        opacity:    50,
                        startLabel: "shot",
                        endLabel:   "dead",
                        theme:      theme
                    }),
                    new Timeline.PointHighlightDecorator({
                        date:       "Fri Nov 22 1963 14:38:00 GMT-0600",
                        color:      "#FFC080",
                        opacity:    50,
                        theme:      theme
                    }),
                    new Timeline.PointHighlightDecorator({
                        date:       "Sun Nov 24 1963 13:00:00 GMT-0600",
                        color:      "#FFC080",
                        opacity:    50,
                        theme:      theme
                    })
                ];
            }
            
            tl = Timeline.create(document.getElementById("tl"), bandInfos, Timeline.HORIZONTAL);
            Timeline.loadXML("jfk.xml", function(xml) { eventSource.loadXML(xml); });
            
            var table = document.getElementById("controls-table");
            var tr = table.rows[1];
            
            for (var i = 0; i < theme.event.highlightColors.length; i++) {
                var td = tr.insertCell(i + 1);
                
                var input = document.createElement("input");
                input.type = "text";
                input.id = "highlight-text-" + i;
                Timeline.DOM.registerEvent(input, "keypress", onKeyPress);
                td.appendChild(input);
                
                var divColor = document.createElement("div");
                divColor.style.height = "0.5em";
                divColor.style.background = theme.event.highlightColors[i];
                td.appendChild(divColor);
            }
        }
        function onResize() {
            tl.layout();
        }
        
        var timerID = null;
        function onKeyPress() {
            if (timerID != null) {
                window.clearTimeout(timerID);
            }
            timerID = window.setTimeout("performFiltering();", 500);
        }
        function cleanString(s) {
            return s.replace(/^\s+/, '').replace(/\s+$/, '');
        }
        function performFiltering() {
            timerID = null;
            
            var text = cleanString(document.getElementById("filter-text").value);
            
            var filterMatcher = null;
            if (text.length > 0) {
                var regex = new RegExp(text, "i");
                filterMatcher = function(evt) {
                    return regex.test(evt.getDescription());
                };
            }
            
            var regexes = [];
            var x = 0;
            var hasHighlights = false;
            while (true) {
                var elmt = document.getElementById("highlight-text-" + x);
                if (elmt == null) {
                    break;
                }
                
                var text2 = cleanString(elmt.value);
                if (text2.length > 0) {
                    hasHighlights = true;
                    regexes.push(new RegExp(text2, "i"));
                } else {
                    regexes.push(null);
                }
                x++;
            }
            var highlightMatcher = hasHighlights ? function(evt) {
                var description = evt.getDescription();
                for (var x = 0; x < regexes.length; x++) {
                    var regex = regexes[x];
                    if (regex != null && regex.test(description)) {
                        return x;
                    }
                }
                return -1;
            } : null;
            
            for (var i = 0; i < tl.getBandCount(); i++) {
                tl.getBand(i).getEventPainter().setFilterMatcher(filterMatcher);
                tl.getBand(i).getEventPainter().setHighlightMatcher(highlightMatcher);
            }
            tl.paint();
        }
        function clearAll() {
            document.getElementById("filter-text").value = "";
            
            var x = 0;
            while (true) {
                var elmt = document.getElementById("highlight-text-" + x);
                if (elmt == null) {
                    break;
                }
                elmt.value = "";
                x++;
            }
            
            for (var i = 0; i < tl.getBandCount(); i++) {
                tl.getBand(i).getEventPainter().setFilterMatcher(null);
                tl.getBand(i).getEventPainter().setHighlightMatcher(null);
            }
            tl.paint();
        }
    </script>
</head>
<body onload="onLoad();" onresize="onResize();">
<div class="header">
    Timeline Examples
</div>
<div class="content">
    <h1>The JFK Assassination</h1>
    <p>Sources:
        <ul>
            <li><a href="http://roswell.fortunecity.com/angelic/96/pctime.htm">http://roswell.fortunecity.com/angelic/96/pctime.htm</a></li>
        </ul>
        Notes: The short titles for these events have been phrased
        by us from the information at the sources above in order
        to fit the timeline below. The phrasing might not be of
        journalistic quality. 
    </p>
    <p>
        This should not be taken as an official source of this topic.
        Refer to other sources, such as 
        <a href="http://en.wikipedia.org/wiki/Kennedy_assassination">Wikipedia</a>, 
        for more official information.
    </p>
    
    <div id="tl" style="height: 400px; border: 1px solid #aaa;">
    </div>
    <div class="footnotes">
        All times are in Dallas CST (GMT-0600).
    </div>
    
    <div class="controls" id="controls">
        <table id="controls-table">
            <tr>
                <td>Filter:</td>
                <td>Highlight:</td>
            </tr>
            <tr valign="top">
                <td><input id="filter-text" onkeypress="onKeyPress();" /></td>
                <td><button onclick="clearAll();">Clear All</button></td>
            </tr>
        </table>
    </div>
</div>

</body>
</html>